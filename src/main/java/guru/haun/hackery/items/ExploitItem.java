package guru.haun.hackery.items;

import java.util.Iterator;
import java.util.List;

import guru.haun.hackery.ExploitUtils;
import guru.haun.hackery.exploits.IExploit;
import net.minecraft.creativetab.CreativeTabs;
import net.minecraft.entity.Entity;
import net.minecraft.entity.EntityLiving;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.init.Items;
import net.minecraft.item.EnumAction;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraft.world.World;

public class ExploitItem extends Item {
	
	private static IExploit getExploit(ItemStack is) {
		return ExploitUtils.getExploitById(is.getItemDamage());
	}
	
	
	public ExploitItem() {
		setHasSubtypes(true);
		setMaxDamage(0);	
		setMaxStackSize(1);
		setTextureName("hackery:Exploit");
	}
	
	public void getSubItems(Item item, CreativeTabs tab, List list){
		List<IExploit> ex = ExploitUtils.getAllExploits();
		Iterator<IExploit> it = ex.iterator();
		while(it.hasNext()){
			list.add(new ItemStack(this,1,it.next().getId()));
		}
	}
	
	public boolean hitEntity(ItemStack is, EntityLivingBase attacker, EntityLivingBase defender){
		return false;
	}
	
	public EnumAction getItemUseAction(ItemStack is){
		IExploit ex = ExploitUtils.getExploitById(is.getItemDamage());
		if(ex.isRanged()){
			return EnumAction.bow;
		}else{
			if(ex.canTargetSelf())
			return EnumAction.eat;
		}
		return EnumAction.none;
	}
	
	public boolean onItemUseFirst(ItemStack stack, EntityPlayer player, World w, int x, int y, int z, int side, float hitX, float hitY, float hitZ){
		return false;
	}
	
	public boolean onLeftClickEntity(ItemStack stack, EntityPlayer player, Entity target){
		IExploit ex = this.getExploit(stack);
		if(ex.canTargetOthers()){
			if(target instanceof EntityPlayer)
				ex.targetUser((EntityPlayer)target);
			else if(ex.canTargetMobs() && target instanceof EntityLiving)
				ex.targetMob(target);
			return true;
		}
		return false;
	}
	
	public boolean onItemUse(ItemStack stack, EntityPlayer player, World w, int x, int y, int z, int side, float hitX, float hitY, float hitZ){
		IExploit ex = this.getExploit(stack);
		if(ex.canTargetOthers() && ex.isRanged()){
			return true;
		}else if(ex.canTargetSelf()){
				ex.targetUser(player);
			return true;
		}
		return false;
	}
	
	public ItemStack onItemRightClick(ItemStack is, World world, EntityPlayer player){
		IExploit ex = this.getExploit(is);
		if(ex.canTargetOthers() && ex.isRanged()) {
			super.onItemRightClick(is, world, player);
		}else if(ex.canTargetSelf()){
			ex.targetUser(player);
			return is;
		}
		return is;
	}
	
	
	public String getUnlocalizedName(ItemStack is) {
		return getExploit(is).getUnlocalizedName();
	}
	
	
}
